<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="reset.css">
	<style>
		body {
			width: 100%;
			height: 100%;
			background: repeating-linear-gradient(
				45deg,
				#b0f5ae,
				#b0f5ae 10px,
				#8ade87 10px,
				#8ade87 20px
			);
			text-align: center;
		}

		#title {
			font-size: 2em;
			font-weight: bold;
		}

		#div1 {
			background: #f5faf5;
			width: 50%;
			position: absolute;
			top: 45%;
			left: 50%;
			transform: translateX(-50%) translateY(-50%);
			display: inline-block;
			border-radius: 20px;
			padding: 1em;
			box-shadow: 0 5px #8ade87;
			color: #4f4f4f;
			font-family: sans-serif;
		}

		#results {
			background: inherit;
			position: absolute;
			box-shadow: inherit;
			right: 0;
			bottom: -3em;
			padding: 0.5em 0em 0.5em 0em;
			display: flex;
			text-align: left;
			border-radius: 0 0 20px 20px;
		}

		#results > div {
			align-self: flex-end;
			margin-right: 2em;
		}

		#whitespace {
			flex-grow: 6 !important;
		}

		.bigText {
			font-weight: bold;
			font-size: 2em;
		}
		.maitsuki {
			color: #8ade87;
		}

		#risiDiv {
/*			background: brown;*/
			flex-grow: 0.1;
		}
		#loangakuDiv {
/*			background: cyan;*/
		}
		#maitsukiDiv {
/*			background: magenta;*/
		}
		#loangakuDiv, #maitsukiDiv {
			text-align: right;
			flex-grow: 1;
		}

		#risi {
			line-height: 2em;
			font-size: 1em;
			border: 1px solid #4f4f4f;
			border-radius: 20px;
			background: inherit;
			-moz-appearance: textfield;
			color: #4f4f4f;
			padding: 0 0 0 0.8em;
			width: 4.5em;
		}

		#contents {
			width: 100%;
			height: 50em;
			max-width: 100%;
			font-size: 1em;
			border: 1px solid #4f4f4f;
			background: inherit;
			border-radius: 20px;
			resize: none;
			padding: 0.5em 1em 0.5em 1em;
			color: inherit;
			margin: 0.5em 0 0.5em 0;
		}

		@media only screen and (min-device-width: 100px) and (max-device-width: 1000px) {
			body {
				font-size: 2em;
			}
			#div1 {
				width: 80%;
				position: absolute;
				top: 0;
				left: 0;
				transform: none;
				box-shadow: 0 10px #8ade87;
			}
			#contents {
				height: 30em;
			}
			#results {
				width: 100%;
			}
		}

	</style>
</head>
<body onload="changed()">
	<div id="div1">
		<div id="title">
			家の計算機！
		</div>
		<textarea id="contents" name="contents" rows="40" columns="70" placeholder="家の設備をここに書くよ〜" oninput="changed()"></textarea>
		<div id="results">
			<div id="whitespace"></div>
			<div id="risiDiv">
				利子<br>
				<input type="number" id="risi" name="利子" min="0" max="100" step="0.001" value="0.572" oninput="changed()"> %
			</div>

			<div id="loangakuDiv">
				ローン額<br>
				<span class="bigText" id="loangaku">0</span>円
			</div>

			<div id="maitsukiDiv">
				毎月の返済額<br>
				<span class="bigText maitsuki" id="maitsuki">0</span>円
			</div>
		</div>
	</div>
</body>
</html>

<script>
	function changed() {
		let textArea = document.getElementById("contents")
		let regex = /\-?\d+$/gm
		let match
		let risi = document.getElementById("risi").value
		let loangaku = document.getElementById("loangaku")
		let maitsuki = document.getElementById("maitsuki")

		let contents = textArea.value.replaceAll(",","")
		console.log(contents)

		let total = 0

		while ((match = regex.exec(contents)) !== null) {
			total += parseInt(match[0])
		}

		loangaku.innerHTML = numberWithCommas(total)
		if (risi=="" || isNaN(risi)) {
			maitsuki.innerHTML = "???"
		} else {
			let maitsukiResult = total * (1+risi/100) / (12*35)
			maitsuki.innerHTML = numberWithCommas(Math.round(maitsukiResult))
		}
	}

	function numberWithCommas(x) { return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") }
</script>